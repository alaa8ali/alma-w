import React, { useState, useEffect } from 'react';\nimport { Product } from '@types/index';\nimport { productService } from '@services/productService';\nimport { Plus, Edit2, Trash2, Search } from 'lucide-react';\nimport toast from 'react-hot-toast';\n\ninterface ProductManagementProps {\n  branchId: string;\n}\n\nconst ProductManagement: React.FC<ProductManagementProps> = ({ branchId }) => {\n  const [products, setProducts] = useState<Product[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [searchQuery, setSearchQuery] = useState('');\n  const [showForm, setShowForm] = useState(false);\n  const [editingProduct, setEditingProduct] = useState<Product | null>(null);\n  const [formData, setFormData] = useState<Partial<Product>>({\n    name: '',\n    description: '',\n    price: 0,\n    stock: 0,\n    category: '',\n  });\n\n  // Fetch products on mount\n  useEffect(() => {\n    fetchProducts();\n  }, [branchId]);\n\n  const fetchProducts = async () => {\n    try {\n      setLoading(true);\n      const response = await productService.getProductsByBranch(branchId);\n      setProducts(response.data);\n    } catch (error) {\n      console.error('Error fetching products:', error);\n      toast.error('Failed to load products');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleAddProduct = async (e: React.FormEvent) => {\n    e.preventDefault();\n    try {\n      const newProduct = await productService.createProduct({\n        ...formData,\n        branchId,\n      });\n      if (newProduct) {\n        setProducts([...products, newProduct]);\n        setFormData({\n          name: '',\n          description: '',\n          price: 0,\n          stock: 0,\n          category: '',\n        });\n        setShowForm(false);\n        toast.success('Product added successfully');\n      }\n    } catch (error) {\n      console.error('Error adding product:', error);\n      toast.error('Failed to add product');\n    }\n  };\n\n  const handleEditProduct = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!editingProduct) return;\n    try {\n      const updated = await productService.updateProduct(editingProduct._id, formData);\n      if (updated) {\n        setProducts(products.map((p) => (p._id === editingProduct._id ? updated : p)));\n        setEditingProduct(null);\n        setFormData({\n          name: '',\n          description: '',\n          price: 0,\n          stock: 0,\n          category: '',\n        });\n        setShowForm(false);\n        toast.success('Product updated successfully');\n      }\n    } catch (error) {\n      console.error('Error updating product:', error);\n      toast.error('Failed to update product');\n    }\n  };\n\n  const handleDeleteProduct = async (productId: string) => {\n    if (!window.confirm('Are you sure you want to delete this product?')) return;\n    try {\n      const success = await productService.deleteProduct(productId);\n      if (success) {\n        setProducts(products.filter((p) => p._id !== productId));\n        toast.success('Product deleted successfully');\n      }\n    } catch (error) {\n      console.error('Error deleting product:', error);\n      toast.error('Failed to delete product');\n    }\n  };\n\n  const handleEditClick = (product: Product) => {\n    setEditingProduct(product);\n    setFormData({\n      name: product.name,\n      description: product.description,\n      price: product.price,\n      stock: product.stock,\n      category: product.category,\n    });\n    setShowForm(true);\n  };\n\n  const filteredProducts = products.filter(\n    (p) =>\n      p.name.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      p.description.toLowerCase().includes(searchQuery.toLowerCase())\n  );\n\n  return (\n    <div className=\"w-full max-w-6xl mx-auto p-6 bg-white rounded-lg shadow-lg\">\n      <div className=\"flex justify-between items-center mb-6\">\n        <h1 className=\"text-3xl font-bold text-gray-800\">Product Management</h1>\n        <button\n          onClick={() => {\n            setEditingProduct(null);\n            setFormData({\n              name: '',\n              description: '',\n              price: 0,\n              stock: 0,\n              category: '',\n            });\n            setShowForm(!showForm);\n          }}\n          className=\"flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700\"\n        >\n          <Plus size={20} />\n          Add Product\n        </button>\n      </div>\n\n      {/* Search Bar */}\n      <div className=\"mb-6\">\n        <div className=\"relative\">\n          <Search className=\"absolute left-3 top-3 text-gray-400\" size={20} />\n          <input\n            type=\"text\"\n            placeholder=\"Search products...\"\n            value={searchQuery}\n            onChange={(e) => setSearchQuery(e.target.value)}\n            className=\"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500\"\n          />\n        </div>\n      </div>\n\n      {/* Add/Edit Product Form */}\n      {showForm && (\n        <div className=\"mb-6 p-6 bg-gray-50 rounded-lg border border-gray-200\">\n          <h2 className=\"text-xl font-semibold mb-4\">\n            {editingProduct ? 'Edit Product' : 'Add New Product'}\n          </h2>\n          <form onSubmit={editingProduct ? handleEditProduct : handleAddProduct} className=\"space-y-4\">\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              <input\n                type=\"text\"\n                placeholder=\"Product Name\"\n                value={formData.name || ''}\n                onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n                required\n                className=\"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500\"\n              />\n              <input\n                type=\"number\"\n                placeholder=\"Price\"\n                value={formData.price || 0}\n                onChange={(e) => setFormData({ ...formData, price: parseFloat(e.target.value) })}\n                required\n                className=\"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500\"\n              />\n            </div>\n            <textarea\n              placeholder=\"Product Description\"\n              value={formData.description || ''}\n              onChange={(e) => setFormData({ ...formData, description: e.target.value })}\n              required\n              className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500\"\n              rows={4}\n            />\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              <input\n                type=\"number\"\n                placeholder=\"Stock\"\n                value={formData.stock || 0}\n                onChange={(e) => setFormData({ ...formData, stock: parseInt(e.target.value) })}\n                required\n                className=\"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500\"\n              />\n              <input\n                type=\"text\"\n                placeholder=\"Category ID\"\n                value={formData.category || ''}\n                onChange={(e) => setFormData({ ...formData, category: e.target.value })}\n                required\n                className=\"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500\"\n              />\n            </div>\n            <div className=\"flex gap-4\">\n              <button\n                type=\"submit\"\n                className=\"flex-1 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700\"\n              >\n                {editingProduct ? 'Update Product' : 'Add Product'}\n              </button>\n              <button\n                type=\"button\"\n                onClick={() => setShowForm(false)}\n                className=\"flex-1 bg-gray-400 text-white px-4 py-2 rounded-lg hover:bg-gray-500\"\n              >\n                Cancel\n              </button>\n            </div>\n          </form>\n        </div>\n      )}\n\n      {/* Products Table */}\n      {loading ? (\n        <div className=\"text-center py-8 text-gray-500\">Loading products...</div>\n      ) : filteredProducts.length === 0 ? (\n        <div className=\"text-center py-8 text-gray-500\">No products found</div>\n      ) : (\n        <div className=\"overflow-x-auto\">\n          <table className=\"w-full border-collapse\">\n            <thead>\n              <tr className=\"bg-gray-100 border-b-2 border-gray-300\">\n                <th className=\"px-4 py-3 text-left font-semibold\">Name</th>\n                <th className=\"px-4 py-3 text-left font-semibold\">Price</th>\n                <th className=\"px-4 py-3 text-left font-semibold\">Stock</th>\n                <th className=\"px-4 py-3 text-left font-semibold\">Rating</th>\n                <th className=\"px-4 py-3 text-left font-semibold\">Actions</th>\n              </tr>\n            </thead>\n            <tbody>\n              {filteredProducts.map((product) => (\n                <tr key={product._id} className=\"border-b border-gray-200 hover:bg-gray-50\">\n                  <td className=\"px-4 py-3\">{product.name}</td>\n                  <td className=\"px-4 py-3\">${product.price.toFixed(2)}</td>\n                  <td className=\"px-4 py-3\">\n                    <span\n                      className={`px-3 py-1 rounded-full text-sm font-semibold ${\n                        product.stock > 0\n                          ? 'bg-green-100 text-green-800'\n                          : 'bg-red-100 text-red-800'\n                      }`}\n                    >\n                      {product.stock}\n                    </span>\n                  </td>\n                  <td className=\"px-4 py-3\">\n                    <span className=\"text-yellow-500\">â˜… {product.rating.toFixed(1)}</span>\n                  </td>\n                  <td className=\"px-4 py-3\">\n                    <div className=\"flex gap-2\">\n                      <button\n                        onClick={() => handleEditClick(product)}\n                        className=\"p-2 text-blue-600 hover:bg-blue-100 rounded-lg\"\n                        title=\"Edit\"\n                      >\n                        <Edit2 size={18} />\n                      </button>\n                      <button\n                        onClick={() => handleDeleteProduct(product._id)}\n                        className=\"p-2 text-red-600 hover:bg-red-100 rounded-lg\"\n                        title=\"Delete\"\n                      >\n                        <Trash2 size={18} />\n                      </button>\n                    </div>\n                  </td>\n                </tr>\n              ))}\n            </tbody>\n          </table>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default ProductManagement;\n
